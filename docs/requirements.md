# 要件定義

最終更新: 2025-12-21

## 目的

- 進捗率を「細かく」設定できるTodoアプリを提供する。
	- 例: 目標回数（分母）を 7 に設定し、実行ごとに 1/7, 2/7... と進捗が増える
- ユーザーが大きな目標を分解し、実行回数の積み上げで達成に近づける状態を作る。

## 対象範囲

- 対象プラットフォーム: iOS / Android
- 配布: App Store / Google Play
- 初期リリースの配信国: 日本のみ
- 対象端末: 複数端末へのインストールは想定する（ただしデータ同期は行わない）

## 主要機能

- Todo（通常タスク）の作成・編集・削除
	- 完了/未完了の切り替え（チェック）
	- 削除時は確認ダイアログを表示する（MVP必須）
		- ボタン: 閉じる / 削除
		- 削除後の復元は行わない
	- 入力制約
		- タイトルは必須
			- 空文字（空白のみ含む）は禁止
			- 空白以外の任意の文字が1文字以上入力されていればOK
			- 最大76文字（暫定）
		- メモは任意
			- 最大文字数は制限しない（無制限）
	- MVPでは期限/優先度/タグは扱わない（将来拡張）
- 継続目標（習慣）の作成・編集・削除
	- 削除時は確認ダイアログを表示する（MVP必須）
		- ボタン: 閉じる / 削除
		- 削除後の復元は行わない
	- 例: 「腹筋を7回達成する」
	- 目標名（必須）と目標回数（分母）（必須・最小1・上限なし）を持つ
		- 目標名の入力制約
			- 空文字（空白のみ含む）は禁止
			- 空白以外の任意の文字が1文字以上入力されていればOK
			- 最大76文字（暫定）
		- ゴール日/期限/期間の設定はMVPでは不要（将来拡張）
	- 実行したことを記録できる（チェック操作で実行回数（分子）を加算）
		- 分子は「回数カウント」のみを保持し、実行日付は保持しない（MVP）
		- 同日に複数回の実行を記録できる（+1 を複数回行える）
		- 誤操作に備えて、取り消し（分子の減算）もできる（MVP必須）
	- 進捗を計算・表示する（例: 1/7）
		- 分子が分母に到達したら完了扱いにする
		- 分子は分母を上限として扱う（分子 > 分母 にはしない）
		- 分母を変更して即完了になることを許可する
			- 分母変更時に警告メッセージを表示する


## 非機能要件

- オフラインで利用できること（端末ローカル保存）
- iOS / Android の双方で同等の機能を提供すること
	- 広告表示はオンライン時のみ発生し得るが、広告の有無に関わらずアプリの主要機能（Todo/継続目標の作成・編集・記録）は利用できること

## 画面/UX

- 画面構成
	- 「Todo一覧」「継続目標一覧」「設定」をタブで分ける
	- 各一覧画面内に「未完了」「完了済み」のタブを用意し、状態に応じて表示を切り替える
		- 未完了タブ: 未完了の項目のみ表示
		- 完了済みタブ: 完了済みの項目のみ表示
		- 未完了タブで完了にした瞬間、その行は一覧から消え、完了済みタブ側に移動する
	- 並び順（新しい順/古い順）はユーザーが切り替えできる
		- 並び順の基準は「更新日時」とする
		- 更新日時は、ユーザー操作によりその項目の状態/内容が変化したタイミングで更新する
			- Todo: タイトル/メモ編集、完了/未完了の切り替え
			- 継続目標: 目標名/分母編集、分子の加算/減算
		- 同一の更新日時が並ぶ場合は、作成日時で並べ替える
			- それでも同値になる場合は、現在の並び（安定ソート）を維持する

	- ダイアログ共通仕様（MVP）
		- タイトル: 原則として付ける
			- 確認系（削除、分母変更など）: 「確認」
			- 達成系（完了/達成時）: 「達成」
		- ボタン順: 各OSの標準に従う（iOS/Androidで同一順に固定しない）
			- キャンセル/閉じる系は「キャンセル」扱い（最も安全な選択肢）として配置する
			- 破壊的操作（削除など）は、OSの標準に従い破壊的な見た目（destructive）として扱う

	- 広告（MVP）
		- 広告形式: バナーのみ
		- 表示箇所
			- 「Todo一覧」画面の下部にバナーを表示する
			- 「継続目標一覧」画面の下部にバナーを表示する
			- 各一覧の「未完了」「完了済み」タブのいずれでもバナーを表示する
			- 詳細/作成/編集画面では表示しない
		- バナーのサイズや読み込み頻度（リロード/キャッシュ等）の最適化はMVP対象外とし、OS/SDKの標準挙動に従う
			- 画面遷移等による軽微なチラつきは許容する（MVP）
		- 失敗時/オフライン時の挙動
			- オフライン時はバナー領域を表示しない（空き領域を残さない）
			- 広告のロード失敗時はバナー領域を表示しない（空き領域を残さない）
		- 運用（MVP）
			- 広告ユニットIDは iOS / Android で分ける
			- 開発・検証中はテスト広告（SDK推奨のテストID/テスト端末設定）を使用する
		- プライバシー/同意（MVP）
			- パーソナライズ広告は前提としない（非パーソナライズ広告を基本とする）
			- 広告SDKの利用に伴うプライバシーポリシーの整備は必須（ストア公開要件）
			- iOSのATT（App Tracking Transparency）
				- MVPでは「トラッキング」を前提としないため、ATT許可ダイアログは表示しない方針とする
				- 将来パーソナライズ広告やクロスアプリ計測等を導入する場合は、ATTの要否を再検討する
			- EU等の同意（GDPR等）
				- MVPは日本中心で公開し、同意取得UI（例: Google UMP）の導入は後回し（将来対応）とする
				- 将来、EU等へ配信する場合は、対象地域の要件に合わせて同意取得（例: UMP）を導入する
			- 子ども向け設定
				- 子ども向け（児童向け）アプリではない前提で設定する
				- 全年齢対象のため、広告コンテンツは過度に成人向けにならないよう制御（例: 最大広告コンテンツレーティングの設定）を検討する

	- 設定（MVP）
		- 問い合わせ
			- 問い合わせはメールのみで受け付ける
		- データについての注意表示
			- 「データは端末内のみで、アプリを削除すると消える（バックアップ/引き継ぎなし）」旨を表示する
				- 表示文言（確定）:
					- 「このアプリのデータは端末内にのみ保存されます。」
					- 「アプリを削除すると、データは消去され復元できません。」
					- 「バックアップ/引き継ぎ/同期機能はありません。」

- Todo（通常タスク）
	- 一覧: Todoの表示（未完了/完了の状態が分かる）
	- 作成/編集: タイトル（必須）とメモ（任意・無制限）を入力して保存できる
		- 入力エラー（空白のみ/76文字超など）は保存ボタン押下時にエラー表示する
	- 一覧上で完了/未完了を切り替えできる
	- 一覧の行をタップすると詳細/編集画面に遷移する
		- 完了済みタブの項目はメモのみ編集可能（タイトルは編集不可）
	- 完了にした瞬間、達成した旨のダイアログを表示する
		- ボタン: 閉じる / 取り消し
		- 閉じる: 状態は変更せず、ダイアログのみ閉じる（完了のまま）
		- 取り消し: 直前の「完了」操作を取り消し、未完了に戻す
			- 「取り消し」は直前の操作のみ（複数手順のUndoは行わない）
	- 削除できる（削除前に確認ダイアログを表示する）
		- ボタン: 閉じる / 削除
		- 削除後の復元は行わない
- 継続目標の作成画面で、以下を入力できる
	- 目標名（必須）（例: 腹筋）
	- 目標回数（必須・最小1・上限なし）（例: 7）
- 継続目標の詳細画面で、以下ができる
	- 「やった」等の操作で実行回数（分子）を +1 する
	- 「取り消し」等の操作で実行回数（分子）を -1 する
	- 進捗（例: 1/7）を表示する
	- 分子が分母に到達したら完了状態を表示する
		- 取り消しにより分子が分母を下回った場合は未完了に戻る
		- 分子が分母に到達した後は「やった（+1）」操作は無効（上限固定）
		- 分子が分母に到達した瞬間、その行は未完了タブから消え、完了済みタブ側に移動する
		- 分子が分母に到達した瞬間、達成した旨のダイアログを表示する
			- ボタン: 閉じる / 取り消し
			- 閉じる: 状態は変更せず、ダイアログのみ閉じる（完了のまま）
			- 取り消し: 直前の「やった（+1）」操作を取り消し、分子を -1 して未完了に戻す
	- 詳細/編集画面で目標名と分母を編集できる
		- 完了済みタブの項目も編集可能
		- 分母変更により完了状態が変化することを許可する（完了→未完了、未完了→完了）
			- 分母変更の保存時、完了状態が変化する場合は警告メッセージを表示する（下げて完了化／上げて未完了化の両方）
				- 警告メッセージ文言（案）: 「目標回数を変更すると、達成状態が変わります。保存しますか？」
				- ボタン（案）: キャンセル / 保存

## データ/保存

- 保存先: 端末ローカル
- 同期: 行わない
- 端末を跨いだデータ共有は要件外（端末ごとに別データで確定）
	- アプリ削除でデータが消えてよい（バックアップ/引き継ぎ要件なし）

### データの持ち方（案）

- Todo（通常タスク）
	- タイトル（必須）
	- メモ（任意・無制限・MVP）
	- 完了状態（未完了/完了）
	- 作成日時
	- 更新日時
		- 作成時の初期値は作成日時と同値とする

- 継続目標
	- 目標名（必須）
	- 目標回数（分母）（必須・最小1・上限なし）
	- 実行回数（分子）
	- 完了状態（分子 >= 分母 で完了扱い。実装上は派生でもフラグでもよい）
	- 作成日時
	- 更新日時
		- 作成時の初期値は作成日時と同値とする

## 制約・前提

- App Store / Google Play で公開できる構成・運用を前提とする
- 現時点ではクラウド連携やアカウント機能は必須ではない

## 技術スタック（決定）

- クロスプラットフォーム: Flutter
- ローカル保存: SQLite（端末内DB）

## 未決事項

- 「目標を細かく設定」の定義
	- 基本方針: 案B（実行記録で進捗が増える継続目標）
	- 進捗の定義
		- 加算単位
			- 同日に複数回の実行を記録できる（確定）
			- 分子の境界条件
				- 0未満にしない
				- 分母を超えた場合の扱い: 上限を分母にする（完了扱い）
				- 分母の制約: 最小1、上限なし（確定）
		- 日付・期間の扱い
			- MVPでは実行日付を保持しないため、期間内達成などの日付依存要件は対象外
- 進捗表示の仕様
	- 1/7 のような分数表示に加えて、達成した旨の表示を行う（確定）
		- 達成時の表示はダイアログ（閉じる/取り消し）とする
- まず作るMVP範囲（例: 期限/通知/繰り返し/タグ/検索の要否）
	- MVPには「Todo（通常タスク）」と「継続目標（カウント型）」の両方を含める（確定）
	- Todo（通常タスク）は最小で開始する（確定）
		- 含める: タイトル、完了/未完了、削除、（任意でメモ）
		- 含めない: 期限、優先度、タグ、検索、手動の並び替え
		- 含める: 新しい順/古い順の切り替え（更新日時基準）
	- 通知（リマインド）は不要（MVP対象外）
	- ゴール日/期限/期間の追加を将来行うか
		- 追加する場合、開始日・終了日・単位・タイムゾーン境界などの仕様が必要

